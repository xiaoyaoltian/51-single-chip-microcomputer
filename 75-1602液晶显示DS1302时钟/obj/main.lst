C51 COMPILER V9.54   MAIN                                                                  08/26/2018 11:22:24 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\obj\main.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\obj\main.lst)
                    - TABS(2) OBJECT(.\obj\main.obj)

line level    source

   1          /*******************************************************************************
   2          * °æ  È¨  : ºìÃ·¿Æ¼¼¹¤×÷ÊÒ
   3          * ÂÛ  Ì³  £ºhttps://blog.csdn.net/Qingzhusshuiyun
   4          * Q Q     £º2369099714
   5          * °æÈ¨ËùÓÐ£¬µÁ°æ±Ø¾¿¡£
   6          * ¹¤  ³Ì   : 1602Òº¾§ÏÔÊ¾ds1302
   7          * ÎÄ¼þÃû   : 1602Òº¾§ÏÔÊ¾ds1302.c
   8          * ´¦ÀíÆ÷   : STC89C52RC
   9          * ±àÒë»·¾³ : Keil 5
  10          * ÏµÍ³Ê±ÖÓ : 12MHZ
  11          * °æ    ±¾  : V1.0 
  12          * Éú³ÉÈÕÆÚ  : 2018-07-15              
  13          * ÐÞ¸ÄÈÕÆÚ  :  
  14          * ¼òµ¥ÃèÊö : Òº¾§ÏÔÊ¾Ê±¼ä
  15              Í¨¹ýdofly×Ô´øµÄ´®¿Úµ÷ÊÔÈí¼þ£¬´ò¿ª´®¿Ú£¬²¨ÌØÂÊÄ¬ÈÏ9600£¬µã»÷¸üÐÂÊ±¼ä¼´¿É£¬Èç¹û²»ÐÐ£¬°´ÏÂ¿ª·¢°å¸´Î»ÖØÐÂ¸üÐ
             -Â
  16          *******************************************************************************/
  17           
  18          #include<reg52.h> //°üº¬Í·ÎÄ¼þ£¬Ò»°ãÇé¿ö²»ÐèÒª¸Ä¶¯£¬Í·ÎÄ¼þ°üº¬ÌØÊâ¹¦ÄÜ¼Ä´æÆ÷µÄ¶¨Òå
  19          #include <stdio.h>
  20          #include "ds1302.h"
  21          #include "delay.h"
  22          #include "1602.h"
  23          
  24          bit ReadTimeFlag;//¶¨Òå¶ÁÊ±¼ä±êÖ¾
  25          bit SetFlag;     //¸üÐÂÊ±¼ä±êÖ¾Î»
  26          unsigned char time_buf2[16];
  27          
  28          void Init_Timer0(void);//¶¨Ê±Æ÷³õÊ¼»¯
  29          void UART_Init(void);
  30          /*------------------------------------------------
  31                              Ö÷º¯Êý
  32          ------------------------------------------------*/
  33          void main (void)
  34          {
  35   1      unsigned char i;                  
  36   1      unsigned char temp[16];//¶¨ÒåÏÔÊ¾ÇøÓòÁÙÊ±´æ´¢Êý×é
  37   1      
  38   1      LCD_Init();           //³õÊ¼»¯Òº¾§
  39   1      DelayMs(20);          //ÑÓÊ±ÓÐÖúÓÚÎÈ¶¨
  40   1      LCD_Clear();          //ÇåÆÁ
  41   1      Init_Timer0();        //¶¨Ê±Æ÷0³õÊ¼»¯
  42   1      Ds1302_Init();        //ds1302³õÊ¼»¯
  43   1      UART_Init();          //´®¿Ú³õÊ¼»¯
  44   1      
  45   1      Ds1302_Read_Time();   //Ê×´Î¶ÁÈ¡Ê±¼ä
  46   1      if((time_buf1[2]+time_buf1[7])==0) //Èç¹ûËùÓÐ²ÎÊý¶¼Îª0£¬Ð´ÈëÒ»¸ö³õÊ¼Öµ
  47   1         Ds1302_Write_Time();    
  48   1      while (1)         //Ö÷Ñ­»·
  49   1        {
  50   2      
  51   2      
  52   2      if(SetFlag)     //Èç¹û½ÓÊÕµ½´®¿ÚÐÅÏ¢Ôò¸üÐÂÊ±ÖÓ
  53   2        {
C51 COMPILER V9.54   MAIN                                                                  08/26/2018 11:22:24 PAGE 2   

  54   3        for(i=0;i<8;i++)
  55   3          {
  56   4          time_buf1[i]=time_buf2[2*i]*10+time_buf2[2*i+1];//Êý¾ÝÕûºÏ£¬Èç2¸öÊý 1ºÍ5ÕûºÏ³É15
  57   4          }
  58   3          Ds1302_Write_Time();//½ÓÊÕ¸üÐÂµÄÊ±¼äÈ»ºóÐ´Èëds1302
  59   3          SetFlag=0;          //Ê±ÖÓÐÅÏ¢¸üÐÂºó±êÖ¾Î»ÇåÁã
  60   3         }
  61   2      
  62   2      
  63   2      if(ReadTimeFlag==1) //¶¨Ê±¶ÁÈ¡ds1302 ¶¨Ê±Ê±¼äµ½ Ôò±êÖ¾Î»ÖÃ1£¬´¦Àí¹ýÊ±¼ä²ÎÊý±êÖ¾Î»ÇåÁã
  64   2      {
  65   3        ReadTimeFlag=0;  //±êÖ¾Î»ÇåÁã
  66   3        Ds1302_Read_Time();//¶ÁÈ¡Ê±¼ä²ÎÊý
  67   3        sprintf(temp,"DATE %02d-%02d-%02d %d",(int)time_buf1[1],(int)time_buf1[2],(int)time_buf1[3],(int)time_bu
             -f1[7]);//ÄêÔÂÈÕÖÜ
  68   3        LCD_Write_String(0,0,temp);//ÏÔÊ¾µÚÒ»ÐÐ
  69   3        sprintf(temp,"TIME %02d:%02d:%02d",(int)time_buf1[4],(int)time_buf1[5],(int)time_buf1[6]);//Ê±·ÖÃë
  70   3        LCD_Write_String(0,1,temp);//ÏÔÊ¾µÚ¶þÐÐ
  71   3        }
  72   2       }
  73   1      }
  74          /*------------------------------------------------
  75                        ´®¿ÚÍ¨Ñ¶³õÊ¼»¯
  76          ------------------------------------------------*/
  77          void UART_Init(void)
  78          {
  79   1          SCON  = 0x50;           // SCON: Ä£Ê½ 1, 8-bit UART, Ê¹ÄÜ½ÓÊÕ  
  80   1          TMOD |= 0x20;               // TMOD: timer 1, mode 2, 8-bit ÖØ×°
  81   1          TH1   = 0xFD;               // TH1:  ÖØ×°Öµ 9600 ²¨ÌØÂÊ ¾§Õñ 11.0592MHz  
  82   1          TR1   = 1;                  // TR1:  timer 1 ´ò¿ª                         
  83   1          EA    = 1;                  //´ò¿ª×ÜÖÐ¶Ï
  84   1          ES    = 1;                  //´ò¿ª´®¿ÚÖÐ¶Ï
  85   1      }
  86          
  87          /*------------------------------------------------
  88                              ¶¨Ê±Æ÷³õÊ¼»¯×Ó³ÌÐò
  89          ------------------------------------------------*/
  90          void Init_Timer0(void)
  91          {
  92   1       TMOD |= 0x01;    //Ê¹ÓÃÄ£Ê½1£¬16Î»¶¨Ê±Æ÷£¬Ê¹ÓÃ"|"·ûºÅ¿ÉÒÔÔÚÊ¹ÓÃ¶à¸ö¶¨Ê±Æ÷Ê±²»ÊÜÓ°Ïì         
  93   1       //TH0=0x00;        //¸ø¶¨³õÖµ
  94   1       //TL0=0x00;
  95   1       EA=1;            //×ÜÖÐ¶Ï´ò¿ª
  96   1       ET0=1;           //¶¨Ê±Æ÷ÖÐ¶Ï´ò¿ª
  97   1       TR0=1;           //¶¨Ê±Æ÷¿ª¹Ø´ò¿ª
  98   1      }
  99          /*------------------------------------------------
 100                           ¶¨Ê±Æ÷ÖÐ¶Ï×Ó³ÌÐò
 101          ------------------------------------------------*/
 102          void Timer0_isr(void) interrupt 1 
 103          {
 104   1       static unsigned int num;
 105   1       TH0=(65536-2000)/256;      //ÖØÐÂ¸³Öµ 2ms
 106   1       TL0=(65536-2000)%256;
 107   1       
 108   1       num++;
 109   1       if(num==50)        //´óÖÂ100ms
 110   1         {
 111   2          num=0;
 112   2          ReadTimeFlag=1; //¶Á±êÖ¾Î»ÖÃ1
 113   2        }
 114   1      }
C51 COMPILER V9.54   MAIN                                                                  08/26/2018 11:22:24 PAGE 3   

 115          
 116          /*------------------------------------------------
 117                            ´®¿ÚÖÐ¶Ï³ÌÐò
 118          ------------------------------------------------*/
 119          void UART_SER (void) interrupt 4 //´®ÐÐÖÐ¶Ï·þÎñ³ÌÐò
 120          {
 121   1          unsigned char Temp;          //¶¨ÒåÁÙÊ±±äÁ¿ 
 122   1          unsigned char i;
 123   1          if(RI)                        //ÅÐ¶ÏÊÇ½ÓÊÕÖÐ¶Ï²úÉú
 124   1           {
 125   2          RI=0;                      //±êÖ¾Î»ÇåÁã
 126   2          Temp=SBUF;                 //¶ÁÈë»º³åÇøµÄÖµ
 127   2          time_buf2[i]=Temp&0x0F;
 128   2          i++;
 129   2          if(i==16)                  //Á¬Ðø½ÓÊÕ16¸ö×Ö·ûÐÅÏ¢
 130   2           {
 131   3            i=0;
 132   3          SetFlag=1;               //½ÓÊÕÍê³É±êÖ¾Î»ÖÃ1
 133   3           }
 134   2            SBUF=Temp; //°Ñ½ÓÊÕµ½µÄÖµÔÙ·¢»ØµçÄÔ¶Ë
 135   2         }
 136   1         if(TI)  //Èç¹ûÊÇ·¢ËÍ±êÖ¾Î»£¬ÇåÁã
 137   1           TI=0;
 138   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    309    ----
   CONSTANT SIZE    =     43    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18      17
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
