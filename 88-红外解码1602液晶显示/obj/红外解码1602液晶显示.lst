C51 COMPILER V9.54   ________1602________                                                  08/26/2018 15:21:05 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE ________1602________
OBJECT MODULE PLACED IN .\obj\红外解码1602液晶显示.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE 红外解码1602液晶显示.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT
                    -(.\obj\红外解码1602液晶显示.lst) TABS(2) OBJECT(.\obj\红外解码1602液晶显示.obj)

line level    source

   1          /*******************************************************************************
   2          * 版  权  : 红梅科技工作室
   3          * 论  坛  ：https://blog.csdn.net/Qingzhusshuiyun
   4          * Q Q     ：2369099714
   5          * 版权所有，盗版必究。
   6          * 工  程   : 红外解码1602液晶显示
   7          * 文件名   : 红外解码1602液晶显示.c
   8          * 处理器   : STC89C52RC
   9          * 编译环境 : Keil 5
  10          * 系统时钟 : 12MHZ
  11          * 版    本  : V1.0 
  12          * 生成日期  : 2018-07-28            
  13          * 修改日期  :  
  14          * 简单描述 : 按配套遥控器按键，液晶显示4组码值，分别是用户码 用户码 数据码 数据反码
  15                  显示如下：
  16               www.hongmei.net
  17               Code:1E-1E-00-FF
  18          *******************************************************************************/
  19           
  20          #include<reg52.h>    //包含头文件，一般情况不需要改动，头文件包含特殊功能寄存器的定义
  21          #include"1602.h"
  22          #include"delay.h"
  23          
  24          sbit IR=P3^2;  //红外接口标志
  25          
  26          char code Tab[16]="0123456789ABCDEF";
  27          /*------------------------------------------------
  28                          全局变量声明
  29          ------------------------------------------------*/
  30          
  31          unsigned char  irtime;//红外用全局变量
  32          
  33          bit irpro_ok,irok;
  34          unsigned char IRcord[4];
  35          unsigned char irdata[33];
  36          
  37          unsigned char TempData[16];
  38          /*------------------------------------------------
  39                            函数声明
  40          ------------------------------------------------*/
  41          void Ir_work(void);
  42          void Ircordpro(void);
  43          
  44          /*------------------------------------------------
  45                            定时器0中断处理
  46          ------------------------------------------------*/
  47          
  48          void tim0_isr (void) interrupt 1 using 1
  49          {
  50   1        irtime++;  //用于计数2个下降沿之间的时间
  51   1      }
  52          
  53          /*------------------------------------------------
  54                            外部中断0中断处理
C51 COMPILER V9.54   ________1602________                                                  08/26/2018 15:21:05 PAGE 2   

  55          ------------------------------------------------*/
  56          void EX0_ISR (void) interrupt 0 //外部中断0服务函数
  57          {
  58   1        static unsigned char  i;             //接收红外信号处理
  59   1        static bit startflag;                //是否开始处理标志位
  60   1      
  61   1      if(startflag)                         
  62   1         {
  63   2          if(irtime<63&&irtime>=33)//引导码 TC9012的头码，9ms+4.5ms
  64   2                              i=0;
  65   2              irdata[i]=irtime;//存储每个电平的持续时间，用于以后判断是0还是1
  66   2              irtime=0;
  67   2              i++;
  68   2               if(i==33)
  69   2                  {
  70   3                 irok=1;
  71   3               i=0;
  72   3                }
  73   2                }
  74   1           else
  75   1          {
  76   2          irtime=0;
  77   2          startflag=1;
  78   2          }
  79   1      
  80   1      }
  81          
  82          /*------------------------------------------------
  83                          定时器0初始化
  84          ------------------------------------------------*/
  85          void TIM0init(void)//定时器0初始化
  86          {
  87   1      
  88   1        TMOD=0x02;//定时器0工作方式2，TH0是重装值，TL0是初值
  89   1        TH0=0x00; //重载值
  90   1        TL0=0x00; //初始化值
  91   1        ET0=1;    //开中断
  92   1        TR0=1;    
  93   1      }
  94          /*------------------------------------------------
  95                            外部中断0初始化
  96          ------------------------------------------------*/
  97          void EX0init(void)
  98          {
  99   1       IT0 = 1;   //指定外部中断0下降沿触发，INT0 (P3.2)
 100   1       EX0 = 1;   //使能外部中断
 101   1       EA = 1;    //开总中断
 102   1      }
 103          /*------------------------------------------------
 104                            键值处理
 105          ------------------------------------------------*/
 106          
 107          void Ir_work(void)
 108          {
 109   1             TempData[0] = Tab[IRcord[0]/16];   //处理客户码
 110   1           TempData[1] = Tab[IRcord[0]%16];
 111   1             TempData[2] = '-';
 112   1           TempData[3] = Tab[IRcord[1]/16];   //处理客户码
 113   1           TempData[4] = Tab[IRcord[1]%16];
 114   1           TempData[5] = '-';
 115   1           TempData[6] = Tab[IRcord[2]/16];   //处理数据码
 116   1           TempData[7] = Tab[IRcord[2]%16];
C51 COMPILER V9.54   ________1602________                                                  08/26/2018 15:21:05 PAGE 3   

 117   1           TempData[8] = '-';
 118   1           TempData[9] = Tab[IRcord[3]/16];   //处理数据反码
 119   1           TempData[10] = Tab[IRcord[3]%16];
 120   1      
 121   1             LCD_Write_String(5,1,TempData);
 122   1      
 123   1           irpro_ok=0;//处理完成标志
 124   1      
 125   1        }
 126          /*------------------------------------------------
 127                          红外码值处理
 128          ------------------------------------------------*/
 129          void Ircordpro(void)//红外码值处理函数
 130          { 
 131   1        unsigned char i, j, k;
 132   1        unsigned char cord,value;
 133   1      
 134   1        k=1;
 135   1        for(i=0;i<4;i++)      //处理4个字节
 136   1           {
 137   2            for(j=1;j<=8;j++) //处理1个字节8位
 138   2               {
 139   3                cord=irdata[k];
 140   3                if(cord>7)//大于某值为1，这个和晶振有绝对关系，这里使用12M计算，此值可以有一定误差
 141   3                   value|=0x80;
 142   3                if(j<8)
 143   3              {
 144   4             value>>=1;
 145   4            }
 146   3                 k++;
 147   3               }
 148   2           IRcord[i]=value;
 149   2           value=0;     
 150   2           } 
 151   1         irpro_ok=1;//处理完毕标志位置1
 152   1      }
 153          
 154          /*------------------------------------------------
 155                              主函数
 156          ------------------------------------------------*/
 157          void main(void)
 158          {
 159   1       EX0init();            //初始化外部中断
 160   1       TIM0init();           //初始化定时器
 161   1      
 162   1       LCD_Init();           //初始化液晶
 163   1       DelayMs(20);          //延时有助于稳定
 164   1       LCD_Clear();          //清屏
 165   1      
 166   1       LCD_Write_String(0,0,"www.hongmei.net");
 167   1       LCD_Write_String(0,1,"Code:");
 168   1      
 169   1       while(1)//主循环
 170   1         {
 171   2          if(irok)                        //如果接收好了进行红外处理
 172   2          {   
 173   3           Ircordpro();
 174   3           irok=0;
 175   3          }
 176   2      
 177   2          if(irpro_ok)                   //如果处理好后进行工作处理，如按对应的按键后显示对应的数字等
 178   2          {
C51 COMPILER V9.54   ________1602________                                                  08/26/2018 15:21:05 PAGE 4   

 179   3           Ir_work();
 180   3            }
 181   2         }
 182   1      }
 183            
 184            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    283    ----
   CONSTANT SIZE    =     38    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     55    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
